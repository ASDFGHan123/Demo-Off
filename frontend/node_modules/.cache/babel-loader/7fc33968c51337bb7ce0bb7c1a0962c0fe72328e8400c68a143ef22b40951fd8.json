{"ast":null,"code":"import _objectSpread from\"c:/Users/salaam/Desktop/OffChat/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from'react';import{useParams}from'react-router-dom';import{Card,Button,Form,Alert,Spinner,Badge}from'react-bootstrap';import{Link}from'react-router-dom';import{useAuth}from'../../context/AuthContext';import{chatAPI}from'../../services/api';import WebSocketService from'../../services/websocket';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ChatDetail=()=>{const{conversationId}=useParams();const{user}=useAuth();const[conversation,setConversation]=useState(null);const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState('');const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[replyTo,setReplyTo]=useState(null);const messagesEndRef=useRef(null);const[socket,setSocket]=useState(null);useEffect(()=>{if(conversationId){loadConversation();loadMessages();connectWebSocket();}return()=>{if(socket){WebSocketService.disconnect();}};},[conversationId]);useEffect(()=>{scrollToBottom();},[messages]);const loadConversation=async()=>{try{const response=await chatAPI.getConversation(parseInt(conversationId));setConversation(response.data);}catch(err){setError('Failed to load conversation');console.error('Error loading conversation:',err);}};const loadMessages=async()=>{try{setLoading(true);const response=await chatAPI.getMessages(parseInt(conversationId));setMessages(response.data);}catch(err){setError('Failed to load messages');console.error('Error loading messages:',err);}finally{setLoading(false);}};const connectWebSocket=()=>{if(conversationId){const ws=WebSocketService.connect(conversationId);ws.on('message',data=>{const newMsg={message_id:data.message_id,content:data.message,sender:{user_id:data.user_id,username:data.user,display_name:data.user},sent_at:data.timestamp,reply_to:data.reply_to?{message_id:data.reply_to,content:data.reply_to_content,sender:{display_name:data.reply_to_sender}}:undefined,attachment:data.attachment,reactions:data.reactions||[]};setMessages(prev=>[...prev,newMsg]);});ws.on('reaction',data=>{setMessages(prev=>prev.map(msg=>msg.message_id===data.message_id?_objectSpread(_objectSpread({},msg),{},{reactions:data.reactions}):msg));});ws.on('user_status',data=>{// Update user online status in conversation\nsetConversation(prev=>{if(!prev)return prev;if(prev.type==='private'){return _objectSpread(_objectSpread({},prev),{},{privatechat:_objectSpread(_objectSpread({},prev.privatechat),{},{user1:prev.privatechat.user1.user_id===data.user_id?_objectSpread(_objectSpread({},prev.privatechat.user1),{},{is_online:data.is_online}):prev.privatechat.user1,user2:prev.privatechat.user2.user_id===data.user_id?_objectSpread(_objectSpread({},prev.privatechat.user2),{},{is_online:data.is_online}):prev.privatechat.user2})});}else if(prev.type==='group'){return _objectSpread(_objectSpread({},prev),{},{groupchat:_objectSpread(_objectSpread({},prev.groupchat),{},{groupmember_set:prev.groupchat.groupmember_set.map(member=>_objectSpread(_objectSpread({},member),{},{user:member.user.user_id===data.user_id?_objectSpread(_objectSpread({},member.user),{},{is_online:data.is_online}):member.user}))})});}return prev;});});setSocket(ws);}};const sendMessage=async e=>{e.preventDefault();if(!newMessage.trim()||!conversationId)return;try{await chatAPI.sendMessage(parseInt(conversationId),newMessage.trim(),replyTo===null||replyTo===void 0?void 0:replyTo.message_id);setNewMessage('');setReplyTo(null);}catch(err){console.error('Error sending message:',err);}};const handleReaction=(messageId,emoji)=>{WebSocketService.sendReaction(messageId,emoji);};const handleReply=message=>{setReplyTo(message);};const cancelReply=()=>{setReplyTo(null);};const scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});};const getParticipants=()=>{if(!conversation)return[];if(conversation.type==='private'){return[conversation.privatechat.user1,conversation.privatechat.user2];}else{return conversation.groupchat.groupmember_set.map(m=>m.user);}};if(loading){return/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(Spinner,{animation:\"border\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading chat...\"})]});}if(error){return/*#__PURE__*/_jsx(Alert,{variant:\"danger\",children:error});}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center mb-4\",children:[/*#__PURE__*/_jsx(Link,{to:\"/chats\",className:\"btn btn-secondary\",children:\"\\u2190 Back to Chats\"}),/*#__PURE__*/_jsx(\"h1\",{children:(conversation===null||conversation===void 0?void 0:conversation.title)||'Chat'}),/*#__PURE__*/_jsx(\"div\",{})]}),/*#__PURE__*/_jsx(Card,{className:\"mb-3\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(\"h6\",{className:\"card-title\",children:\"Participants\"}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex flex-wrap gap-2\",children:getParticipants().map(participant=>/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"me-2\",children:participant.display_name}),/*#__PURE__*/_jsx(Badge,{bg:participant.is_online?'success':'secondary',children:participant.is_online?'Online':'Offline'})]},participant.user_id))})]})}),/*#__PURE__*/_jsx(Card,{className:\"mb-3\",children:/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat-messages p-3\",style:{height:'400px',overflowY:'auto'},children:[messages.map(message=>/*#__PURE__*/_jsxs(\"div\",{className:\"message mb-2 \".concat(message.sender.user_id===(user===null||user===void 0?void 0:user.user_id)?'message-own':'message-other'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-start\",children:[/*#__PURE__*/_jsxs(\"strong\",{children:[message.sender.display_name,\":\"]}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted ms-2\",children:new Date(message.sent_at).toLocaleTimeString()})]}),/*#__PURE__*/_jsx(\"div\",{children:message.content}),message.reply_to&&/*#__PURE__*/_jsx(\"div\",{className:\"reply-indicator ms-3 mt-1 p-2 border-start\",children:/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[\"Replying to \",message.reply_to.sender.display_name,\": \",message.reply_to.content.substring(0,50),\"...\"]})}),message.attachment&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-1\",children:/*#__PURE__*/_jsxs(\"small\",{children:[/*#__PURE__*/_jsxs(\"a\",{href:message.attachment.file,target:\"_blank\",rel:\"noopener noreferrer\",children:[\"\\uD83D\\uDCCE \",message.attachment.file_name]}),\"(\",(message.attachment.file_size/1024).toFixed(1),\" KB)\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"reactions mt-1\",children:message.reactions.map((reaction,index)=>/*#__PURE__*/_jsxs(Badge,{bg:\"light\",text:\"dark\",className:\"me-1 reaction-button\",children:[reaction.emoji,\" \",reaction.count]},index))}),/*#__PURE__*/_jsxs(\"div\",{className:\"message-actions mt-1\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",size:\"sm\",className:\"me-1\",onClick:()=>handleReaction(message.message_id,'üëç'),children:\"\\uD83D\\uDC4D\"}),/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",size:\"sm\",className:\"me-1\",onClick:()=>handleReaction(message.message_id,'‚ù§Ô∏è'),children:\"\\u2764\\uFE0F\"}),/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",size:\"sm\",className:\"me-1\",onClick:()=>handleReaction(message.message_id,'üòÇ'),children:\"\\uD83D\\uDE02\"}),/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",size:\"sm\",onClick:()=>handleReply(message),children:\"Reply\"})]})]},message.message_id)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]})})}),replyTo&&/*#__PURE__*/_jsx(Alert,{variant:\"info\",className:\"mb-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsxs(\"small\",{children:[\"Replying to \",/*#__PURE__*/_jsx(\"strong\",{children:replyTo.sender.display_name}),\": \",replyTo.content.substring(0,50),\"...\"]}),/*#__PURE__*/_jsx(Button,{variant:\"close\",size:\"sm\",onClick:cancelReply})]})}),/*#__PURE__*/_jsx(Form,{onSubmit:sendMessage,children:/*#__PURE__*/_jsxs(\"div\",{className:\"input-group\",children:[/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Type a message...\",value:newMessage,onChange:e=>setNewMessage(e.target.value),required:true}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"primary\",children:\"Send\"})]})})]});};export default ChatDetail;","map":{"version":3,"names":["React","useState","useEffect","useRef","useParams","Card","Button","Form","Alert","Spinner","Badge","Link","useAuth","chatAPI","WebSocketService","jsx","_jsx","jsxs","_jsxs","ChatDetail","conversationId","user","conversation","setConversation","messages","setMessages","newMessage","setNewMessage","loading","setLoading","error","setError","replyTo","setReplyTo","messagesEndRef","socket","setSocket","loadConversation","loadMessages","connectWebSocket","disconnect","scrollToBottom","response","getConversation","parseInt","data","err","console","getMessages","ws","connect","on","newMsg","message_id","content","message","sender","user_id","username","display_name","sent_at","timestamp","reply_to","reply_to_content","reply_to_sender","undefined","attachment","reactions","prev","map","msg","_objectSpread","type","privatechat","user1","is_online","user2","groupchat","groupmember_set","member","sendMessage","e","preventDefault","trim","handleReaction","messageId","emoji","sendReaction","handleReply","cancelReply","_messagesEndRef$curre","current","scrollIntoView","behavior","getParticipants","m","className","children","animation","variant","to","title","Body","participant","bg","style","height","overflowY","concat","Date","toLocaleTimeString","substring","href","file","target","rel","file_name","file_size","toFixed","reaction","index","text","count","size","onClick","ref","onSubmit","Control","placeholder","value","onChange","required"],"sources":["c:/Users/salaam/Desktop/OffChat/frontend/src/components/chat/ChatDetail.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { Card, Button, Form, Alert, Spinner, Badge } from 'react-bootstrap';\r\nimport { Link } from 'react-router-dom';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { chatAPI } from '../../services/api';\r\nimport WebSocketService from '../../services/websocket';\r\n\r\ninterface Message {\r\n  message_id: number;\r\n  content: string;\r\n  sender: {\r\n    user_id: number;\r\n    username: string;\r\n    display_name: string;\r\n  };\r\n  sent_at: string;\r\n  reply_to?: {\r\n    message_id: number;\r\n    content: string;\r\n    sender: {\r\n      display_name: string;\r\n    };\r\n  };\r\n  attachment?: {\r\n    file_name: string;\r\n    mime_type: string;\r\n    file_size: number;\r\n    file: string;\r\n  };\r\n  reactions: Array<{\r\n    emoji: string;\r\n    count: number;\r\n    users: string[];\r\n  }>;\r\n  is_edited?: boolean;\r\n  is_deleted?: boolean;\r\n}\r\n\r\ninterface Conversation {\r\n  conversation_id: number;\r\n  type: 'private' | 'group';\r\n  title?: string;\r\n  privatechat?: {\r\n    user1: { user_id: number; display_name: string; is_online: boolean };\r\n    user2: { user_id: number; display_name: string; is_online: boolean };\r\n  };\r\n  groupchat?: {\r\n    groupmember_set: Array<{\r\n      user: { user_id: number; display_name: string; is_online: boolean };\r\n    }>;\r\n  };\r\n}\r\n\r\nconst ChatDetail: React.FC = () => {\r\n  const { conversationId } = useParams<{ conversationId: string }>();\r\n  const { user } = useAuth();\r\n  const [conversation, setConversation] = useState<Conversation | null>(null);\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [replyTo, setReplyTo] = useState<Message | null>(null);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const [socket, setSocket] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    if (conversationId) {\r\n      loadConversation();\r\n      loadMessages();\r\n      connectWebSocket();\r\n    }\r\n\r\n    return () => {\r\n      if (socket) {\r\n        WebSocketService.disconnect();\r\n      }\r\n    };\r\n  }, [conversationId]);\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  const loadConversation = async () => {\r\n    try {\r\n      const response = await chatAPI.getConversation(parseInt(conversationId!));\r\n      setConversation(response.data);\r\n    } catch (err) {\r\n      setError('Failed to load conversation');\r\n      console.error('Error loading conversation:', err);\r\n    }\r\n  };\r\n\r\n  const loadMessages = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await chatAPI.getMessages(parseInt(conversationId!));\r\n      setMessages(response.data);\r\n    } catch (err) {\r\n      setError('Failed to load messages');\r\n      console.error('Error loading messages:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const connectWebSocket = () => {\r\n    if (conversationId) {\r\n      const ws = WebSocketService.connect(conversationId);\r\n\r\n      ws.on('message', (data: any) => {\r\n        const newMsg: Message = {\r\n          message_id: data.message_id,\r\n          content: data.message,\r\n          sender: {\r\n            user_id: data.user_id,\r\n            username: data.user,\r\n            display_name: data.user\r\n          },\r\n          sent_at: data.timestamp,\r\n          reply_to: data.reply_to ? {\r\n            message_id: data.reply_to,\r\n            content: data.reply_to_content,\r\n            sender: { display_name: data.reply_to_sender }\r\n          } : undefined,\r\n          attachment: data.attachment,\r\n          reactions: data.reactions || []\r\n        };\r\n        setMessages(prev => [...prev, newMsg]);\r\n      });\r\n\r\n      ws.on('reaction', (data: any) => {\r\n        setMessages(prev => prev.map(msg =>\r\n          msg.message_id === data.message_id\r\n            ? { ...msg, reactions: data.reactions }\r\n            : msg\r\n        ));\r\n      });\r\n\r\n      ws.on('user_status', (data: any) => {\r\n        // Update user online status in conversation\r\n        setConversation(prev => {\r\n          if (!prev) return prev;\r\n          if (prev.type === 'private') {\r\n            return {\r\n              ...prev,\r\n              privatechat: {\r\n                ...prev.privatechat!,\r\n                user1: prev.privatechat!.user1.user_id === data.user_id\r\n                  ? { ...prev.privatechat!.user1, is_online: data.is_online }\r\n                  : prev.privatechat!.user1,\r\n                user2: prev.privatechat!.user2.user_id === data.user_id\r\n                  ? { ...prev.privatechat!.user2, is_online: data.is_online }\r\n                  : prev.privatechat!.user2\r\n              }\r\n            };\r\n          } else if (prev.type === 'group') {\r\n            return {\r\n              ...prev,\r\n              groupchat: {\r\n                ...prev.groupchat!,\r\n                groupmember_set: prev.groupchat!.groupmember_set.map(member => ({\r\n                  ...member,\r\n                  user: member.user.user_id === data.user_id\r\n                    ? { ...member.user, is_online: data.is_online }\r\n                    : member.user\r\n                }))\r\n              }\r\n            };\r\n          }\r\n          return prev;\r\n        });\r\n      });\r\n\r\n      setSocket(ws);\r\n    }\r\n  };\r\n\r\n  const sendMessage = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!newMessage.trim() || !conversationId) return;\r\n\r\n    try {\r\n      await chatAPI.sendMessage(parseInt(conversationId), newMessage.trim(), replyTo?.message_id);\r\n      setNewMessage('');\r\n      setReplyTo(null);\r\n    } catch (err) {\r\n      console.error('Error sending message:', err);\r\n    }\r\n  };\r\n\r\n  const handleReaction = (messageId: number, emoji: string) => {\r\n    WebSocketService.sendReaction(messageId, emoji);\r\n  };\r\n\r\n  const handleReply = (message: Message) => {\r\n    setReplyTo(message);\r\n  };\r\n\r\n  const cancelReply = () => {\r\n    setReplyTo(null);\r\n  };\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  };\r\n\r\n  const getParticipants = () => {\r\n    if (!conversation) return [];\r\n    if (conversation.type === 'private') {\r\n      return [conversation.privatechat!.user1, conversation.privatechat!.user2];\r\n    } else {\r\n      return conversation.groupchat!.groupmember_set.map(m => m.user);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"text-center\">\r\n        <Spinner animation=\"border\" />\r\n        <p>Loading chat...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return <Alert variant=\"danger\">{error}</Alert>;\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"d-flex justify-content-between align-items-center mb-4\">\r\n        <Link to=\"/chats\" className=\"btn btn-secondary\">‚Üê Back to Chats</Link>\r\n        <h1>{conversation?.title || 'Chat'}</h1>\r\n        <div></div>\r\n      </div>\r\n\r\n      {/* Participants Status */}\r\n      <Card className=\"mb-3\">\r\n        <Card.Body>\r\n          <h6 className=\"card-title\">Participants</h6>\r\n          <div className=\"d-flex flex-wrap gap-2\">\r\n            {getParticipants().map(participant => (\r\n              <div key={participant.user_id} className=\"d-flex align-items-center\">\r\n                <span className=\"me-2\">{participant.display_name}</span>\r\n                <Badge bg={participant.is_online ? 'success' : 'secondary'}>\r\n                  {participant.is_online ? 'Online' : 'Offline'}\r\n                </Badge>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </Card.Body>\r\n      </Card>\r\n\r\n      {/* Messages */}\r\n      <Card className=\"mb-3\">\r\n        <Card.Body>\r\n          <div className=\"chat-messages p-3\" style={{ height: '400px', overflowY: 'auto' }}>\r\n            {messages.map(message => (\r\n              <div\r\n                key={message.message_id}\r\n                className={`message mb-2 ${message.sender.user_id === user?.user_id ? 'message-own' : 'message-other'}`}\r\n              >\r\n                <div className=\"d-flex justify-content-between align-items-start\">\r\n                  <strong>{message.sender.display_name}:</strong>\r\n                  <small className=\"text-muted ms-2\">\r\n                    {new Date(message.sent_at).toLocaleTimeString()}\r\n                  </small>\r\n                </div>\r\n                <div>{message.content}</div>\r\n\r\n                {message.reply_to && (\r\n                  <div className=\"reply-indicator ms-3 mt-1 p-2 border-start\">\r\n                    <small className=\"text-muted\">\r\n                      Replying to {message.reply_to.sender.display_name}: {message.reply_to.content.substring(0, 50)}...\r\n                    </small>\r\n                  </div>\r\n                )}\r\n\r\n                {message.attachment && (\r\n                  <div className=\"mt-1\">\r\n                    <small>\r\n                      <a href={message.attachment.file} target=\"_blank\" rel=\"noopener noreferrer\">\r\n                        üìé {message.attachment.file_name}\r\n                      </a>\r\n                      ({(message.attachment.file_size / 1024).toFixed(1)} KB)\r\n                    </small>\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"reactions mt-1\">\r\n                  {message.reactions.map((reaction, index: number) => (\r\n                    <Badge key={index} bg=\"light\" text=\"dark\" className=\"me-1 reaction-button\">\r\n                      {reaction.emoji} {reaction.count}\r\n                    </Badge>\r\n                  ))}\r\n                </div>\r\n\r\n                <div className=\"message-actions mt-1\">\r\n                  <Button\r\n                    variant=\"outline-secondary\"\r\n                    size=\"sm\"\r\n                    className=\"me-1\"\r\n                    onClick={() => handleReaction(message.message_id, 'üëç')}\r\n                  >\r\n                    üëç\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"outline-secondary\"\r\n                    size=\"sm\"\r\n                    className=\"me-1\"\r\n                    onClick={() => handleReaction(message.message_id, '‚ù§Ô∏è')}\r\n                  >\r\n                    ‚ù§Ô∏è\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"outline-secondary\"\r\n                    size=\"sm\"\r\n                    className=\"me-1\"\r\n                    onClick={() => handleReaction(message.message_id, 'üòÇ')}\r\n                  >\r\n                    üòÇ\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"outline-secondary\"\r\n                    size=\"sm\"\r\n                    onClick={() => handleReply(message)}\r\n                  >\r\n                    Reply\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            ))}\r\n            <div ref={messagesEndRef} />\r\n          </div>\r\n        </Card.Body>\r\n      </Card>\r\n\r\n      {/* Reply Indicator */}\r\n      {replyTo && (\r\n        <Alert variant=\"info\" className=\"mb-3\">\r\n          <div className=\"d-flex justify-content-between align-items-center\">\r\n            <small>\r\n              Replying to <strong>{replyTo.sender.display_name}</strong>: {replyTo.content.substring(0, 50)}...\r\n            </small>\r\n            <Button variant=\"close\" size=\"sm\" onClick={cancelReply} />\r\n          </div>\r\n        </Alert>\r\n      )}\r\n\r\n      {/* Message Input */}\r\n      <Form onSubmit={sendMessage}>\r\n        <div className=\"input-group\">\r\n          <Form.Control\r\n            type=\"text\"\r\n            placeholder=\"Type a message...\"\r\n            value={newMessage}\r\n            onChange={(e) => setNewMessage(e.target.value)}\r\n            required\r\n          />\r\n          <Button type=\"submit\" variant=\"primary\">\r\n            Send\r\n          </Button>\r\n        </div>\r\n      </Form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatDetail;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}