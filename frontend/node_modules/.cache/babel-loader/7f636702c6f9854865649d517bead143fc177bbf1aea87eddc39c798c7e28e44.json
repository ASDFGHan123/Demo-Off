{"ast":null,"code":"import{io}from'socket.io-client';class WebSocketService{constructor(){this.socket=null;this.reconnectAttempts=0;this.maxReconnectAttempts=5;this.reconnectDelay=1000;}connect(roomName){var _this$socket;if((_this$socket=this.socket)!==null&&_this$socket!==void 0&&_this$socket.connected){return this.socket;}const protocol=window.location.protocol==='https:'?'wss:':'ws:';const wsUrl=\"\".concat(protocol,\"//\").concat(window.location.host,\"/ws/chat/\").concat(roomName,\"/\");this.socket=io(wsUrl,{transports:['websocket','polling'],upgrade:true,rememberUpgrade:true,timeout:20000});this.socket.on('connect',()=>{console.log('WebSocket connected');this.reconnectAttempts=0;});this.socket.on('disconnect',reason=>{console.log('WebSocket disconnected:',reason);if(reason==='io server disconnect'){// Server disconnected, try to reconnect\nthis.attemptReconnect(roomName);}});this.socket.on('connect_error',error=>{console.error('WebSocket connection error:',error);this.attemptReconnect(roomName);});return this.socket;}attemptReconnect(roomName){if(this.reconnectAttempts<this.maxReconnectAttempts){this.reconnectAttempts++;console.log(\"Attempting to reconnect... (\".concat(this.reconnectAttempts,\"/\").concat(this.maxReconnectAttempts,\")\"));setTimeout(()=>{this.connect(roomName);},this.reconnectDelay*this.reconnectAttempts);}else{console.error('Max reconnection attempts reached');}}disconnect(){if(this.socket){this.socket.disconnect();this.socket=null;}}sendMessage(message){if(this.socket){this.socket.emit('message',message);}}sendReaction(messageId,emoji){if(this.socket){this.socket.emit('reaction',{message_id:messageId,emoji});}}sendReadReceipt(messageId){if(this.socket){this.socket.emit('read_receipt',{message_id:messageId});}}editMessage(messageId,content){if(this.socket){this.socket.emit('edit_message',{message_id:messageId,content});}}deleteMessage(messageId){if(this.socket){this.socket.emit('delete_message',{message_id:messageId});}}replyToMessage(messageId,content,replyToId){if(this.socket){this.socket.emit('message',{message:content,reply_to:replyToId});}}onMessage(callback){if(this.socket){this.socket.on('message',callback);}}onReaction(callback){if(this.socket){this.socket.on('reaction',callback);}}onUserStatus(callback){if(this.socket){this.socket.on('user_status',callback);}}onNotification(callback){if(this.socket){this.socket.on('notification',callback);}}onMessageEdited(callback){if(this.socket){this.socket.on('message_edited',callback);}}onMessageDeleted(callback){if(this.socket){this.socket.on('message_deleted',callback);}}onReadReceipt(callback){if(this.socket){this.socket.on('read_receipt',callback);}}off(event,callback){if(this.socket){this.socket.off(event,callback);}}}export default new WebSocketService();","map":{"version":3,"names":["io","WebSocketService","constructor","socket","reconnectAttempts","maxReconnectAttempts","reconnectDelay","connect","roomName","_this$socket","connected","protocol","window","location","wsUrl","concat","host","transports","upgrade","rememberUpgrade","timeout","on","console","log","reason","attemptReconnect","error","setTimeout","disconnect","sendMessage","message","emit","sendReaction","messageId","emoji","message_id","sendReadReceipt","editMessage","content","deleteMessage","replyToMessage","replyToId","reply_to","onMessage","callback","onReaction","onUserStatus","onNotification","onMessageEdited","onMessageDeleted","onReadReceipt","off","event"],"sources":["c:/Users/salaam/Desktop/OffChat/frontend/src/services/websocket.ts"],"sourcesContent":["import { io, Socket } from 'socket.io-client';\r\n\r\nclass WebSocketService {\r\n  private socket: Socket | null = null;\r\n  private reconnectAttempts = 0;\r\n  private maxReconnectAttempts = 5;\r\n  private reconnectDelay = 1000;\r\n\r\n  connect(roomName: string): Socket {\r\n    if (this.socket?.connected) {\r\n      return this.socket;\r\n    }\r\n\r\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\r\n    const wsUrl = `${protocol}//${window.location.host}/ws/chat/${roomName}/`;\r\n\r\n    this.socket = io(wsUrl, {\r\n      transports: ['websocket', 'polling'],\r\n      upgrade: true,\r\n      rememberUpgrade: true,\r\n      timeout: 20000,\r\n    });\r\n\r\n    this.socket.on('connect', () => {\r\n      console.log('WebSocket connected');\r\n      this.reconnectAttempts = 0;\r\n    });\r\n\r\n    this.socket.on('disconnect', (reason) => {\r\n      console.log('WebSocket disconnected:', reason);\r\n      if (reason === 'io server disconnect') {\r\n        // Server disconnected, try to reconnect\r\n        this.attemptReconnect(roomName);\r\n      }\r\n    });\r\n\r\n    this.socket.on('connect_error', (error) => {\r\n      console.error('WebSocket connection error:', error);\r\n      this.attemptReconnect(roomName);\r\n    });\r\n\r\n    return this.socket;\r\n  }\r\n\r\n  private attemptReconnect(roomName: string) {\r\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\r\n      this.reconnectAttempts++;\r\n      console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`);\r\n\r\n      setTimeout(() => {\r\n        this.connect(roomName);\r\n      }, this.reconnectDelay * this.reconnectAttempts);\r\n    } else {\r\n      console.error('Max reconnection attempts reached');\r\n    }\r\n  }\r\n\r\n  disconnect() {\r\n    if (this.socket) {\r\n      this.socket.disconnect();\r\n      this.socket = null;\r\n    }\r\n  }\r\n\r\n  sendMessage(message: any) {\r\n    if (this.socket) {\r\n      this.socket.emit('message', message);\r\n    }\r\n  }\r\n\r\n  sendReaction(messageId: number, emoji: string) {\r\n    if (this.socket) {\r\n      this.socket.emit('reaction', { message_id: messageId, emoji });\r\n    }\r\n  }\r\n\r\n  sendReadReceipt(messageId: number) {\r\n    if (this.socket) {\r\n      this.socket.emit('read_receipt', { message_id: messageId });\r\n    }\r\n  }\r\n\r\n  editMessage(messageId: number, content: string) {\r\n    if (this.socket) {\r\n      this.socket.emit('edit_message', { message_id: messageId, content });\r\n    }\r\n  }\r\n\r\n  deleteMessage(messageId: number) {\r\n    if (this.socket) {\r\n      this.socket.emit('delete_message', { message_id: messageId });\r\n    }\r\n  }\r\n\r\n  replyToMessage(messageId: number, content: string, replyToId?: number) {\r\n    if (this.socket) {\r\n      this.socket.emit('message', {\r\n        message: content,\r\n        reply_to: replyToId\r\n      });\r\n    }\r\n  }\r\n\r\n  onMessage(callback: (data: any) => void) {\r\n    if (this.socket) {\r\n      this.socket.on('message', callback);\r\n    }\r\n  }\r\n\r\n  onReaction(callback: (data: any) => void) {\r\n    if (this.socket) {\r\n      this.socket.on('reaction', callback);\r\n    }\r\n  }\r\n\r\n  onUserStatus(callback: (data: any) => void) {\r\n    if (this.socket) {\r\n      this.socket.on('user_status', callback);\r\n    }\r\n  }\r\n\r\n  onNotification(callback: (data: any) => void) {\r\n    if (this.socket) {\r\n      this.socket.on('notification', callback);\r\n    }\r\n  }\r\n\r\n  onMessageEdited(callback: (data: any) => void) {\r\n    if (this.socket) {\r\n      this.socket.on('message_edited', callback);\r\n    }\r\n  }\r\n\r\n  onMessageDeleted(callback: (data: any) => void) {\r\n    if (this.socket) {\r\n      this.socket.on('message_deleted', callback);\r\n    }\r\n  }\r\n\r\n  onReadReceipt(callback: (data: any) => void) {\r\n    if (this.socket) {\r\n      this.socket.on('read_receipt', callback);\r\n    }\r\n  }\r\n\r\n  off(event: string, callback?: Function) {\r\n    if (this.socket) {\r\n      this.socket.off(event, callback);\r\n    }\r\n  }\r\n}\r\n\r\nexport default new WebSocketService();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}